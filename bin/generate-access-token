#!/bin/sh

set -e

# Change the Readeck token and the serial of your Kobo.
READECK_TOKEN="$1"
KOBO_SERIAL="$2"

if [ -z "$READECK_TOKEN" ] || [ -z "$KOBO_SERIAL" ]; then
    echo "Usage: $0 <READECK_TOKEN> <KOBO_SERIAL>" >&2
    exit 1
fi

STATIC_SALT="88b3a2e13"
KEY="$(echo -n "$STATIC_SALT$KOBO_SERIAL" | sha256sum | cut -b -16)"
HEX_KEY="$(echo -n "$KEY" | xxd -p -l 16)"

echo -n "$READECK_TOKEN" | openssl enc -aes-128-ecb -base64 -A -K "$HEX_KEY" -nosalt && echo
